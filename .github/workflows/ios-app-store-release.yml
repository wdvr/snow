name: iOS App Store Release

# Fully automated App Store release with AI-generated release notes
# Uses shared workflow from ios-infra

on:
  workflow_dispatch:
    inputs:
      app_version:
        description: 'App version (e.g., 1.0.0)'
        required: true
        default: '1.0.0'
        type: string
      build_number:
        description: 'Build number to release (from TestFlight)'
        required: true
        type: string
      generate_screenshots:
        description: 'Generate new screenshots'
        required: false
        default: true
        type: boolean
      generate_description:
        description: 'Generate description with AI'
        required: false
        default: true
        type: boolean
      generate_release_notes:
        description: 'Generate release notes with AI (from commits since last release)'
        required: false
        default: true
        type: boolean
      submit_for_review:
        description: 'Submit to App Store review'
        required: false
        default: true
        type: boolean

concurrency:
  group: ios-app-store-release
  cancel-in-progress: false

permissions:
  actions: read
  contents: write

jobs:
  release:
    uses: wdvr/ios-infra/.github/workflows/ios-app-store-release.yml@main
    with:
      bundle_id: com.wouterdevriendt.snowtracker
      scheme: SnowTracker
      app_version: ${{ github.event.inputs.app_version }}
      build_number: ${{ github.event.inputs.build_number }}
      app_name: Powder Chaser
      app_context: 'A ski resort snow tracking app with real-time conditions, powder alerts, and weather forecasts for resorts worldwide'
      generate_screenshots: ${{ github.event.inputs.generate_screenshots }}
      generate_description: ${{ github.event.inputs.generate_description }}
      generate_release_notes: ${{ github.event.inputs.generate_release_notes }}
      submit_for_review: ${{ github.event.inputs.submit_for_review }}
      use_xcodegen: true
      xcodegen_path: ios
      project_path: ios/SnowTracker.xcodeproj
    secrets: inherit
